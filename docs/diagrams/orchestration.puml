@startuml orchestration
title 🧩 Text-to-SQL Multi-Agent Orchestration (Semantic Kernel + Azure Foundry)

actor User as U
participant "SQL Generator Agent" as A
participant "Guardrail Agent" as G
participant "SQL Executor Agent" as X
participant "Regenerator Agent" as R
participant "Summarizer Agent" as S
participant "Visualization Agent" as W
participant "Power BI Exporter" as B
database "Database" as D
cloud "Azure Foundry / Semantic Kernel" as SK

U -> A : "Show top 5 products by revenue"
A -> G : Propose SQL query
G -> G : Validate SQL safety
G --> A : "Safe? Yes/No"

alt SQL unsafe
    G -> U : ❌ Unsafe SQL (Rejected)
else SQL safe
    A -> X : Execute SQL
    X -> D : Run SQL
    D --> X : Rows / Error
    alt Execution Error
        X -> R : Send error + previous SQL
        R -> A : Regenerate SQL
        A -> X : Retry execution
    else Success
        X -> S : Send rows
        S -> W : Recommend visualization
        W -> B : Export to Power BI (optional)
        B -> U : Power BI link
        S -> U : Summary in natural language
        W -> U : Chart visualization
    end
end

note over SK
Semantic Kernel orchestrates all agents using
Magentic orchestration pattern in Azure Foundry.
end note

@enduml
